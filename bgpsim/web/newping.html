<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ping</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="AYH">
    <link href="static/assets/css/bootstrap.css" rel="stylesheet">
    <link href="static/assets/css/theme.css" rel="stylesheet">
    <link href="static/assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="static/assets/css/alertify.css" rel="stylesheet">   
    <link href="static/assets/css/colorpicker.css" rel="stylesheet">
    <link href="static/assets/css/datepicker.css" rel="stylesheet">
    <link href="static/assets/css/timepicker.css" rel="stylesheet">
    <link href="static/assets/css/select2.css" rel="stylesheet">
  </head>
  <body>
  <div id="wrap">
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          

          <div class="top-menu visible-desktop">
            <ul class="pull-right">  
              <li><a href="login.html"><i class="icon-off"></i> Logout</a></li>
            </ul>
          </div>

          <div class="top-menu visible-phone visible-tablet">
            <ul class="pull-right">  
              <li><a href="login.html"><i class="icon-off"></i></a></li>
            </ul>
          </div>

        </div>
      </div>
    </div>


    <div class="container-fluid">
     
      <!-- Main window -->
      <div class="container" id="forms_page">
        <div class="row-fluid">
          <ul class="breadcrumb">            
            <li class="active"><a href="/" target="_blank">拓扑图</a><span class="divider">|</span></li>
            <li class="active"><a href="/form" target="_blank">攻击表单</a><span class="divider">|</span></li>
            <li class="active"><a href="xielou" target="_blank">BGP泄漏</a><span class="divider">|</span></li>
            <li class="active"><a href="pinggraph" target="_blank">Ping</a><span class="divider">|</span></li> 
            <li class="active"><a href="traceroute" target="_blank">Traceroute</a><span class="divider">|</span></li> 
            <li class="active"><a href="tcpdump" target="_blank">Tcpdump</a></li>
          </ul>
          <h2 class="heading">
                Ping                
          </h2>
        </div>
        
        <div class="row-fluid">


          <div class="widget widget-padding span12" style="margin-top: 20px;margin-bottom: 20px;">
          <div class="widget-header">
            <i class="icon-bar-chart"></i>
            <h5>Ping</h5>
            <div class="widget-buttons">
                <a href="javascript:void(0)" class="collapse" data-collapsed="false"><i data-title="Collapse" class="icon-chevron-up"></i></a>
            </div>
          </div>
          <div class="widget-body clearfix">
            
              <!-- <form class="form-inline">
                <input type="text" class="span4" placeholder="Email">
                <input type="password" class="span4" placeholder="Password">
                <button type="submit" class="btn btn-success">Sign in</button>
              </form> -->
              <div class="span1"></div>
              <form class="form-inline span10" style="margin-top: 15px;">
                <div class="input-append">
                  <span class="add-on">从</span><input type="text" id="ping2ip1" placeholder="发起ping的ip">
                </div>
                <!-- <input type="text" class="span4" placeholder="Username"> -->
                <div class="input-append">
                  <span class="add-on">到</span><input type="text" id="ping2ip2" placeholder="ping的目的地址">
                </div>
                <button class="btn btn-primary" type="button" onclick="startwsping1();">Ping</button>
                <button class="btn btn-primary" type="button" onclick="stopping1();">停止</button>
              </form>
              <div class="span1"></div>

              <!-- 从<input type="text" name="ip1">到<input type="text" name="ip2"><input type="button" value="开始"> -->
            
            <div style="height:300px;" id="graph" class="widget-analytics-large">
              
            </div>
          </div>
          
          <div class="widget-body clearfix" style="">
            <div class="span1"></div>
              <form class="form-inline span10" style="margin-top: 15px;">
                <div class="input-append">
                  <span class="add-on">从</span><input type="text" id="ping2ip3" placeholder="发起ping的ip">
                </div>
                <!-- <input type="text" class="span4" placeholder="Username"> -->
                <div class="input-append">
                  <span class="add-on">到</span><input type="text" id="ping2ip4" placeholder="ping的目的地址">
                </div>                
                <button class="btn btn-primary" type="button" onclick="startping2();">Ping</button>
                <button class="btn btn-primary" type="button" onclick="stopping2();">停止</button>
              </form>
              <div class="span1"></div>
            <div style="height:300px;" id="graph2" class="widget-analytics-large">
              
            </div>
          </div>
        </div>
        </div>  
        

    </div><!-- wrap ends-->
    </div><!--/.fluid-container-->
    <script type="text/javascript" src="static/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/assets/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="static/assets/js/raphael-min.js"></script>
    <script type="text/javascript" src="static/assets/js/bootstrap.js"></script>
    <script type="text/javascript" src='static/assets/js/sparkline.js'></script>
    <script type="text/javascript" src='static/assets/js/morris.min.js'></script>
    <script type="text/javascript" src="static/assets/js/jquery.dataTables.min.js"></script>   
    <script type="text/javascript" src="static/assets/js/jquery.masonry.min.js"></script>   
    <script type="text/javascript" src="static/assets/js/jquery.imagesloaded.min.js"></script>   
    <script type="text/javascript" src="static/assets/js/jquery.facybox.js"></script>   
    <script type="text/javascript" src="static/assets/js/jquery.alertify.min.js"></script> 
    <script type="text/javascript" src="static/assets/js/jquery.knob.js"></script>
    <script type='text/javascript' src='static/assets/js/fullcalendar.min.js'></script>
    <script type='text/javascript' src='static/assets/js/jquery.gritter.min.js'></script>
    <script type="text/javascript" src="static/assets/js/realm.js"></script>
    <script type="text/javascript" src="static/assets/js/jquery.slimscroll.min.js"></script>
  
    <script type="text/javascript" src="static/assets/js/select2.min.js"></script>
    <script type="text/javascript" src="static/assets/js/bootstrap-colorpicker.js"></script>
    <script type="text/javascript" src="static/assets/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="static/assets/js/bootstrap-timepicker.js"></script>
    <script src="static/dist/echarts.js"></script>
    <script type="text/javascript">
        var timeTicket;var timeTicket2;var pingstart=0;var pingstart2=0;
        var ping2ip1,ping2ip2,ping2ip3,ping2ip4;
    </script>

    <script type="text/javascript">
var host="10.11.118.68";
var wsport="8881";
function start_ws1(id){
    ws = new WebSocket("ws://" + host + ":" + wsport + "/ws");
     
    ws.onmessage = function(evt) {
      console.log("message received: " + evt.data);
    };
    ws.onclose = function(evt) {
      console.log("Connection close");
    };
    ws.onopen = function(evt) { 
      ws.send('{"id":"'+id+'"}');
      console.log("Connection Opened");
      
    };
}

function startwsping1(){
        ping2ip1=document.getElementById("ping2ip1").value;
        ping2ip2=document.getElementById("ping2ip2").value;
	start_ws1(ping2ip1+'-'+ping2ip2);
}
      function startping1() {
        var xmlhttp;
        ping2ip1=document.getElementById("ping2ip1").value;
        ping2ip2=document.getElementById("ping2ip2").value;
        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp=new XMLHttpRequest();
        }
        else{// code for IE6, IE5
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET","pingstart?start=0&ip1="+ping2ip1+"&ip2="+ping2ip2,true);
        xmlhttp.send();
        pingstart = 1;
      };
function start_ws2(id){
    ws = new WebSocket("ws://" + host + ":" + wsport + "/ws");
     
    ws.onmessage = function(evt) {
      console.log("message received: " + evt.data);
    };
    ws.onclose = function(evt) {
      console.log("Connection close");
    };
    ws.onopen = function(evt) { 
      ws.send('{"id":"'+id+'"}');
      console.log("Connection Opened");
      
    };
}

function startwsping2(){
        ping2ip3=document.getElementById("ping2ip3").value;
        ping2ip4=document.getElementById("ping2ip4").value;
	start_ws2(ping2ip3+'-'+ping2ip4);
}
      function startping2() {
        var xmlhttp;
        ping2ip3=document.getElementById("ping2ip3").value;
        ping2ip4=document.getElementById("ping2ip4").value;
        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp=new XMLHttpRequest();
        }
        else{// code for IE6, IE5
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET","pingstart?start=0&ip1="+ping2ip3+"&ip2="+ping2ip4,true);
        xmlhttp.send();
        pingstart2 = 1;
      };
      function stopping1(argument) {
        var xmlhttp;
        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp=new XMLHttpRequest();
        }
        else{// code for IE6, IE5
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET","pingstart?start=1&ip1="+ping2ip1+"&ip2="+ping2ip2,true);
        xmlhttp.send();
        pingstart=0;
      };
      function stopping2(argument) {
        var xmlhttp;
        if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
          xmlhttp=new XMLHttpRequest();
        }
        else{// code for IE6, IE5
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET","pingstart?start=1&ip1="+ping2ip3+"&ip2="+ping2ip4,true);
        xmlhttp.send();
        pingstart2=0;
      };
    </script>
    <script type="text/javascript">
        require.config({
            paths: {
                echarts: 'static/dist'
            }
        });
        require(
            [
                'echarts',
                'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                'echarts/chart/bar'
            ],
            function (ec) {
                var myChart = ec.init(document.getElementById('graph'));
                var option = {
                    tooltip : {
                        trigger: 'axis'
                    },
                    dataZoom : {
                        show : false,
                        start : 0,
                        end : 100
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : true,
                            data : (function (){
                                var now = new Date();
                                var res = [];                                
                                var len = 1;
                                while (len--) {
                                    res.unshift(now.toLocaleTimeString().replace(/^\D*/,''));
                                    now = new Date(now);
                                }
                                return res;
                            })()
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            scale: true,
                            name : 'RTT',
                            boundaryGap: [0.2, 0.2]
                        }//,                        
                    ],
                    series : [                    
                        {
                            name:'RTT',
                            type:'bar',
                            data:(function (){
                                var res = [0];
                                return res;
                            })()
                        }
                    ]
                };
                var lastData = 11;
                var axisData;
                var fso, ts, s ; 
                var ForReading = 1;
                var rtt = 0;                 
                
                clearInterval(timeTicket);
                timeTicket = setInterval(function (){
                  if (pingstart==1){
                    var xmlhttp;
                    if (window.XMLHttpRequest)
                    {// code for IE7+, Firefox, Chrome, Opera, Safari
                      xmlhttp=new XMLHttpRequest();
                    }
                    else
                    {// code for IE6, IE5
                      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                    }
                    xmlhttp.open("GET","ping?file="+ping2ip1+"-"+ping2ip2,true);
                    xmlhttp.send();
                    
                    xmlhttp.onreadystatechange=function()
                    {
                        if ((xmlhttp.readyState==4 && xmlhttp.status==200) || (xmlhttp.status==304 && xmlhttp.readyState==1))
                        {
                           rtt=xmlhttp.responseText;
                        }
                    }
                    axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');
                    lastData = parseFloat(rtt);
                    
                    // 动态数据接口 addData
                    myChart.addData([
                        [
                            0,        // 系列索引
                            lastData, // 新增数据
                            false,    // 新增数据是否从队列头部插入
                            true,    // 是否增加队列长度，false则自定删除原有数据，队头插入删队尾，队尾插入删队头
                            axisData  // 坐标轴标签
                        ]
                    ]);
                  }
                }, 1200);
            myChart.setOption(option);
            }
            
        );
    </script>
    <script type="text/javascript">
       require.config({
            paths: {
                echarts: 'static/dist'
            }
        });
        require(
            [
                'echarts',
                'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                'echarts/chart/bar'
            ],
            function (ec) {
                var myChart = ec.init(document.getElementById('graph2'));
                var option = {
                    tooltip : {
                        trigger: 'axis'
                    },
                    dataZoom : {
                        show : false,
                        start : 0,
                        end : 100
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : true,
                            data : (function (){
                                var now = new Date();
                                var res = [];                                
                                var len = 1;
                                while (len--) {
                                    res.unshift(now.toLocaleTimeString().replace(/^\D*/,''));
                                    now = new Date(now);
                                }
                                return res;
                            })()
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            scale: true,
                            name : 'RTT',
                            boundaryGap: [0.2, 0.2]
                        }//,                        
                    ],
                    series : [                    
                        {
                            name:'RTT',
                            type:'bar',
                            data:(function (){
                                var res = [0];
                                return res;
                            })()
                        }
                    ]
                };
                var lastData = 11;
                var axisData;
                var fso, ts, s ; 
                var ForReading = 1;
                var rtt = 1;                 
                var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                  xmlhttp=new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
                clearInterval(timeTicket2);
                timeTicket2 = setInterval(function (){
                  if (pingstart2==1){
                    xmlhttp.open("GET","ping?file="+ping2ip3+"-"+ping2ip4,true);
                    xmlhttp.send();
                    
                    xmlhttp.onreadystatechange=function()
                    {
                        if ((xmlhttp.readyState==4 && xmlhttp.status==200) || (xmlhttp.status==304 && xmlhttp.readyState==1))
                        {
                           rtt=xmlhttp.responseText;
                        }
                    }
                    axisData = (new Date()).toLocaleTimeString().replace(/^\D*/,'');
                    lastData = parseFloat(rtt);
                    
                    // 动态数据接口 addData
                    myChart.addData([
                        [
                            0,        // 系列索引
                            lastData, // 新增数据
                            false,    // 新增数据是否从队列头部插入
                            true,    // 是否增加队列长度，false则自定删除原有数据，队头插入删队尾，队尾插入删队头
                            axisData  // 坐标轴标签
                        ]
                    ]);
                  }
                }, 1200);
            myChart.setOption(option);
            }
        );
    </script>
  </body>
</html>
